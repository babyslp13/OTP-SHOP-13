<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP STORE - MULTI APP BASKET</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap');
        body { font-family: 'Kanit', sans-serif; background-color: #0c0c0e; color: #e4e4e7; margin: 0; padding-bottom: 120px; }
        .glass-card { background: rgba(23, 23, 27, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .btn-primary { background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%); transition: all 0.3s ease; }
        .hidden { display: none !important; }
        input, textarea, select { background: #18181b !important; border: 1px solid #27272a !important; color: white !important; outline: none; }
        .nav-active { color: #a855f7; }
        .app-tab { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .app-tab-active { border-bottom: 2px solid #a855f7; color: #a855f7; background: rgba(168, 85, 247, 0.05); }
        
        /* App Branding */
        .brand-facebook { color: #1877F2; background: rgba(24, 119, 242, 0.1); }
        .brand-line { color: #06C755; background: rgba(6, 199, 85, 0.1); }
        .brand-tiktok { color: #ff0050; background: rgba(255, 0, 80, 0.1); }
        .brand-instagram { color: #E4405F; background: rgba(228, 64, 95, 0.1); }
        .brand-telegram { color: #26A5E4; background: rgba(38, 165, 228, 0.1); }
        .brand-twitter { color: #ffffff; background: rgba(255, 255, 255, 0.1); }
        .brand-other { color: #a855f7; background: rgba(168, 85, 247, 0.1); }

        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen relative">

    <!-- Auth Screen -->
    <div id="auth-screen" class="fixed inset-0 z-[2000] bg-[#0c0c0e] flex items-center justify-center p-6 hidden">
        <div class="glass-card p-8 rounded-[2.5rem] w-full border border-purple-500/20 text-center">
            <h1 id="auth-title" class="text-2xl font-black italic text-white uppercase mb-8 tracking-tighter">เข้าสู่ระบบ</h1>
            <div class="space-y-4">
                <input type="text" id="auth-user" placeholder="ชื่อผู้ใช้งาน" class="w-full p-4 rounded-2xl text-sm">
                <input type="password" id="auth-pass" placeholder="รหัสผ่าน (6 ตัวขึ้นไป)" class="w-full p-4 rounded-2xl text-sm">
                <button onclick="handleAuth()" class="w-full btn-primary p-4 rounded-2xl font-black uppercase text-sm text-white mt-4 shadow-lg shadow-purple-500/20">Login</button>
                <button onclick="toggleAuthMode()" id="auth-switch" class="w-full text-[10px] text-gray-500 mt-6 font-bold uppercase tracking-widest">ยังไม่มีบัญชี? สมัครสมาชิก</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="p-6 pb-2 sticky top-0 bg-[#0c0c0e]/95 backdrop-blur-md z-50">
        <div class="flex justify-between items-center mb-4">
            <div class="flex flex-col">
                <span class="font-black text-2xl italic uppercase text-white">OTP<span class="text-purple-500">STORE</span></span>
                <span class="text-[8px] text-gray-500 font-bold uppercase tracking-[0.2em]">Automatic Delivery</span>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleCart()" class="relative glass-card w-10 h-10 rounded-xl border border-white/5 flex items-center justify-center">
                    <i class="fa-solid fa-shopping-cart text-sm"></i>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-purple-500 text-[8px] font-black w-4 h-4 rounded-full flex items-center justify-center text-white hidden">0</span>
                </button>
                <div class="glass-card px-4 py-2 rounded-xl border border-purple-500/30">
                    <span id="top-balance" class="text-white font-bold text-sm">0.00 ฿</span>
                </div>
            </div>
        </div>

        <!-- App Tabs -->
        <div id="app-tabs" class="flex gap-2 overflow-x-auto no-scrollbar py-2">
            <button onclick="filterApp('all')" id="tab-all" class="app-tab app-tab-active px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap">ทั้งหมด</button>
            <button onclick="filterApp('line')" id="tab-line" class="app-tab px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap"><i class="fa-solid fa-comment-dots mr-1"></i> Line</button>
            <button onclick="filterApp('tiktok')" id="tab-tiktok" class="app-tab px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap"><i class="fa-brands fa-tiktok mr-1"></i> TikTok</button>
            <button onclick="filterApp('facebook')" id="tab-facebook" class="app-tab px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap"><i class="fa-brands fa-facebook mr-1"></i> Facebook</button>
            <button onclick="filterApp('instagram')" id="tab-instagram" class="app-tab px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap"><i class="fa-brands fa-instagram mr-1"></i> IG</button>
            <button onclick="filterApp('telegram')" id="tab-telegram" class="app-tab px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap"><i class="fa-brands fa-telegram mr-1"></i> Telegram</button>
        </div>
    </header>

    <main class="px-6 space-y-6">
        <!-- Shop Tab -->
        <section id="tab-shop" class="space-y-4">
            <div id="product-list" class="grid grid-cols-1 gap-4">
                <div class="text-center py-20 opacity-20"><i class="fa-solid fa-spinner fa-spin text-2xl"></i></div>
            </div>
        </section>

        <!-- Deposit Tab -->
        <section id="tab-deposit" class="hidden space-y-6 pt-4">
            <h2 class="text-xl font-black uppercase italic">เติมเงินเข้าระบบ</h2>
            <div class="glass-card p-6 rounded-[2rem] space-y-4">
                <div class="bg-blue-600/10 p-5 rounded-2xl border border-blue-500/10 text-center">
                    <p class="text-[9px] font-bold text-blue-400 uppercase tracking-widest">Support Payment</p>
                    <p class="font-bold text-lg mt-1 text-white">TrueMoney / PromptPay</p>
                </div>
                <input type="number" id="dep-amt" placeholder="จำนวนเงิน" class="w-full p-4 rounded-xl text-sm">
                <input type="text" id="dep-ref" placeholder="เลขอ้างอิงสลิป" class="w-full p-4 rounded-xl text-sm">
                <button onclick="submitDeposit()" class="w-full bg-blue-600 text-white p-4 rounded-xl font-black uppercase text-xs shadow-lg active:scale-95">แจ้งฝาก</button>
            </div>
        </section>

        <!-- Profile Tab -->
        <section id="tab-profile" class="hidden space-y-6 pt-10 text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-purple-500/10 to-blue-500/10 rounded-[2rem] mx-auto flex items-center justify-center text-3xl text-purple-500 border border-white/5 mb-4">
                <i class="fa-solid fa-id-badge"></i>
            </div>
            <h3 class="text-2xl font-black text-white" id="prof-user">---</h3>
            <div class="grid grid-cols-2 gap-3 mt-6">
                <div class="glass-card p-4 rounded-2xl text-left">
                    <p class="text-[8px] text-gray-500 uppercase font-bold">ยอดเงิน</p>
                    <p id="prof-balance" class="font-bold text-white text-lg">0.00 ฿</p>
                </div>
                <div class="glass-card p-4 rounded-2xl text-left">
                    <p class="text-[8px] text-gray-500 uppercase font-bold">สถานะ</p>
                    <p id="prof-role" class="font-bold text-green-500 text-lg italic">Standard</p>
                </div>
            </div>
            <button onclick="firebase.auth().signOut()" class="w-full bg-red-500/10 text-red-500 p-5 rounded-3xl font-black uppercase text-[10px] border border-red-500/10 mt-10">Logout</button>
        </section>

        <!-- Admin Tab -->
        <section id="tab-admin" class="hidden space-y-6 pt-4 pb-10">
            <h2 class="text-xl font-black text-yellow-500 uppercase italic">Admin Console</h2>
            <div id="admin-dep-list" class="space-y-3"></div>
            
            <div class="glass-card p-5 rounded-3xl border-purple-500/20">
                <p class="text-[10px] font-bold text-gray-400 uppercase mb-4">เพิ่มสินค้าใหม่</p>
                <div class="space-y-3">
                    <select id="p-cat" class="w-full p-3 rounded-xl text-xs">
                        <option value="line">Line OTP</option>
                        <option value="tiktok">TikTok OTP</option>
                        <option value="facebook">Facebook OTP</option>
                        <option value="instagram">Instagram OTP</option>
                        <option value="telegram">Telegram OTP</option>
                        <option value="twitter">X (Twitter) OTP</option>
                        <option value="other">อื่นๆ</option>
                    </select>
                    <input type="text" id="p-name" placeholder="ชื่อบริการ" class="w-full p-3 rounded-xl text-xs">
                    <input type="number" id="p-price" placeholder="ราคาต่อชิ้น" class="w-full p-3 rounded-xl text-xs">
                    <textarea id="p-stock" placeholder="ข้อมูล (1 บรรทัด = 1 รายการ)" class="w-full p-3 rounded-xl text-xs h-28"></textarea>
                    <button onclick="adminAddProduct()" class="w-full btn-primary p-4 rounded-xl font-bold text-xs uppercase">ยืนยันการเพิ่ม</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Shopping Cart Sidebar -->
    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-80 bg-[#121214] z-[1500] shadow-2xl translate-x-full transition-transform duration-300 border-l border-white/5 flex flex-col p-6">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-xl font-black uppercase italic text-white">ตะกร้าของคุณ</h2>
            <button onclick="toggleCart()" class="text-gray-500"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto space-y-4 no-scrollbar">
            <!-- Items go here -->
        </div>
        <div class="pt-6 border-t border-white/5">
            <div class="flex justify-between items-center mb-4">
                <span class="text-xs font-bold text-gray-500 uppercase">ยอดรวมทั้งหมด</span>
                <span id="cart-total" class="text-xl font-black text-white italic">0.00 ฿</span>
            </div>
            <button onclick="checkoutCart()" class="w-full btn-primary p-4 rounded-2xl font-black uppercase text-xs">ชำระเงิน</button>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div id="buy-modal" class="fixed inset-0 z-[2000] bg-black/95 flex items-center justify-center p-6 hidden">
        <div class="glass-card p-8 rounded-[3rem] w-full text-center border border-green-500/20">
            <div class="w-16 h-16 bg-green-500/10 text-green-500 rounded-full mx-auto flex items-center justify-center text-3xl mb-4">
                <i class="fa-solid fa-check"></i>
            </div>
            <h2 class="text-white font-black uppercase italic">ซื้อสำเร็จ!</h2>
            <p class="text-[10px] text-gray-500 mt-2 mb-6 uppercase">คัดลอกข้อมูลไปใช้งาน</p>
            <div id="item-result" class="bg-black p-5 rounded-2xl font-mono text-green-400 text-xs break-all border border-white/5 mb-6 text-left max-h-40 overflow-y-auto"></div>
            <button onclick="document.getElementById('buy-modal').classList.add('hidden')" class="w-full btn-primary p-4 rounded-2xl font-black uppercase text-xs">ปิด</button>
        </div>
    </div>

    <!-- Nav Bar -->
    <nav class="fixed bottom-6 left-6 right-6 max-w-md mx-auto h-20 bg-[#121214]/95 backdrop-blur-xl border border-white/5 flex justify-around items-center z-[100] rounded-[2.5rem] shadow-2xl">
        <button onclick="switchTab('shop')" id="nav-shop" class="flex flex-col items-center gap-1 nav-active transition-all">
            <i class="fa-solid fa-house text-lg"></i>
            <span class="text-[8px] font-black uppercase">Store</span>
        </button>
        <button onclick="switchTab('deposit')" id="nav-deposit" class="flex flex-col items-center gap-1 text-gray-600">
            <i class="fa-solid fa-wallet text-lg"></i>
            <span class="text-[8px] font-black uppercase">Deposit</span>
        </button>
        <button onclick="switchTab('profile')" id="nav-profile" class="flex flex-col items-center gap-1 text-gray-600">
            <i class="fa-solid fa-user-circle text-lg"></i>
            <span class="text-[8px] font-black uppercase">Profile</span>
        </button>
        <button id="nav-admin" onclick="switchTab('admin')" class="hidden flex flex-col items-center gap-1 text-yellow-600 animate-pulse">
            <i class="fa-solid fa-shield-halved text-lg"></i>
            <span class="text-[8px] font-black uppercase">Admin</span>
        </button>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAnC_H0mfIJWY_Y73kRFnjtWZvOHIOOopQ",
            authDomain: "project-otp-shop.firebaseapp.com",
            projectId: "project-otp-shop",
            storageBucket: "project-otp-shop.firebasestorage.app",
            messagingSenderId: "832041026630",
            appId: "1:832041026630:web:47e06a714d93ff7d58f647"
        };

        const ADMIN_UID = "SwyfQIRVRwMuuruyDKwO4fo183I3";
        const VER = "v5_basket_system";

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userData = null;
        let cart = [];
        let currentFilter = 'all';

        const APP_ICONS = {
            facebook: 'fa-brands fa-facebook-f',
            line: 'fa-solid fa-comment-dots',
            tiktok: 'fa-brands fa-tiktok',
            instagram: 'fa-brands fa-instagram',
            telegram: 'fa-brands fa-telegram-plane',
            twitter: 'fa-brands fa-x-twitter',
            other: 'fa-solid fa-mobile-screen'
        };

        function toggleAuthMode() {
            const title = document.getElementById('auth-title');
            const switchBtn = document.getElementById('auth-switch');
            if(title.innerText === 'เข้าสู่ระบบ') {
                title.innerText = 'สมัครสมาชิก';
                switchBtn.innerText = 'มีบัญชีอยู่แล้ว? เข้าสู่ระบบ';
            } else {
                title.innerText = 'เข้าสู่ระบบ';
                switchBtn.innerText = 'ยังไม่มีบัญชี? สมัครสมาชิก';
            }
        }

        async function handleAuth() {
            const u = document.getElementById('auth-user').value.trim();
            const p = document.getElementById('auth-pass').value;
            if(!u || p.length < 6) return alert('รหัสผ่านต้องมี 6 ตัวขึ้นไป');
            const email = `${u.toLowerCase()}@otp.store`;
            const isLogin = document.getElementById('auth-title').innerText === 'เข้าสู่ระบบ';

            try {
                if(isLogin) {
                    await auth.signInWithEmailAndPassword(email, p);
                } else {
                    const res = await auth.createUserWithEmailAndPassword(email, p);
                    await db.collection('shop').doc(VER).collection('users').doc(res.user.uid).set({
                        username: u, balance: 0, uid: res.user.uid, role: 'user'
                    });
                }
            } catch(e) { alert('บัญชีหรือรหัสผ่านไม่ถูกต้อง'); }
        }

        function switchTab(t) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`tab-${t}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active', 'text-white'));
            document.querySelectorAll('nav button').forEach(b => b.classList.add('text-gray-600'));
            document.getElementById(`nav-${t}`).classList.add('nav-active', 'text-white');
        }

        function filterApp(app) {
            currentFilter = app;
            document.querySelectorAll('.app-tab').forEach(t => t.classList.remove('app-tab-active'));
            document.getElementById(`tab-${app}`).classList.add('app-tab-active');
            loadProducts();
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('auth-screen').classList.add('hidden');
                db.collection('shop').doc(VER).collection('users').doc(user.uid).onSnapshot(doc => {
                    if(doc.exists) {
                        userData = doc.data();
                        document.getElementById('top-balance').innerText = userData.balance.toFixed(2) + ' ฿';
                        document.getElementById('prof-balance').innerText = userData.balance.toFixed(2) + ' ฿';
                        document.getElementById('prof-user').innerText = userData.username;
                        if(user.uid === ADMIN_UID) {
                            document.getElementById('nav-admin').classList.remove('hidden');
                            loadAdminTasks();
                        }
                    }
                });
                loadProducts();
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
            }
        });

        function loadProducts() {
            db.collection('shop').doc(VER).collection('products').onSnapshot(snap => {
                const list = document.getElementById('product-list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const p = doc.data();
                    if(currentFilter !== 'all' && p.category !== currentFilter) return;

                    const icon = APP_ICONS[p.category] || APP_ICONS.other;
                    const stock = p.stock ? p.stock.length : 0;
                    
                    list.innerHTML += `
                        <div class="glass-card p-4 rounded-[1.8rem] flex items-center justify-between border-white/5">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-2xl brand-${p.category || 'other'} flex items-center justify-center text-2xl">
                                    <i class="${icon}"></i>
                                </div>
                                <div>
                                    <h4 class="font-black text-sm text-white">${p.name}</h4>
                                    <div class="flex items-center gap-2 mt-0.5">
                                        <p class="text-xs text-purple-400 font-black">฿ ${p.price}</p>
                                        <span class="text-[8px] bg-white/5 px-2 py-0.5 rounded text-gray-500 font-bold uppercase">STOCK: ${stock}</span>
                                    </div>
                                </div>
                            </div>
                            <button onclick="addToCart('${doc.id}', '${p.name}', ${p.price})" class="bg-white/5 hover:bg-white hover:text-black px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all">ใส่ตะกร้า</button>
                        </div>
                    `;
                });
            });
        }

        function addToCart(pid, name, price) {
            const existing = cart.find(i => i.pid === pid);
            if(existing) {
                existing.qty++;
            } else {
                cart.push({ pid, name, price, qty: 1 });
            }
            updateCartUI();
        }

        function toggleCart() {
            const side = document.getElementById('cart-sidebar');
            side.classList.toggle('translate-x-full');
        }

        function updateCartUI() {
            const list = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            list.innerHTML = '';
            let total = 0;
            let count = 0;

            cart.forEach((item, idx) => {
                total += item.price * item.qty;
                count += item.qty;
                list.innerHTML += `
                    <div class="bg-white/5 p-4 rounded-2xl flex justify-between items-center">
                        <div>
                            <p class="text-[10px] font-black text-white uppercase">${item.name}</p>
                            <p class="text-[9px] text-purple-500 font-black">฿ ${item.price} x ${item.qty}</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="changeQty(${idx}, -1)" class="w-6 h-6 rounded bg-black flex items-center justify-center text-[10px]"><i class="fa-solid fa-minus"></i></button>
                            <button onclick="changeQty(${idx}, 1)" class="w-6 h-6 rounded bg-black flex items-center justify-center text-[10px]"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                `;
            });

            totalEl.innerText = total.toFixed(2) + ' ฿';
            if(count > 0) {
                countEl.innerText = count;
                countEl.classList.remove('hidden');
            } else {
                countEl.classList.add('hidden');
            }
        }

        function changeQty(idx, val) {
            cart[idx].qty += val;
            if(cart[idx].qty <= 0) cart.splice(idx, 1);
            updateCartUI();
        }

        async function checkoutCart() {
            if(cart.length === 0) return alert('ตะกร้าว่างเปล่า');
            let total = cart.reduce((s, i) => s + (i.price * i.qty), 0);
            if(userData.balance < total) return alert('ยอดเงินไม่เพียงพอ');

            if(confirm(`ยืนยันการชำระเงินรวม ${total.toFixed(2)} ฿?`)) {
                try {
                    let results = [];
                    for(const item of cart) {
                        const pRef = db.collection('shop').doc(VER).collection('products').doc(item.pid);
                        const pDoc = await pRef.get();
                        const pData = pDoc.data();
                        
                        if(!pData.stock || pData.stock.length < item.qty) {
                            alert(`สินค้า ${item.name} มีไม่พอ (เหลือ ${pData.stock ? pData.stock.length : 0})`);
                            return;
                        }

                        const stock = [...pData.stock];
                        const itemsBought = stock.splice(0, item.qty);
                        
                        await db.runTransaction(async (t) => {
                            t.update(pRef, { stock: stock });
                            t.update(db.collection('shop').doc(VER).collection('users').doc(auth.currentUser.uid), {
                                balance: firebase.firestore.FieldValue.increment(-(item.price * item.qty))
                            });
                        });
                        results.push(...itemsBought);
                    }
                    
                    document.getElementById('item-result').innerHTML = results.join('<br>');
                    document.getElementById('buy-modal').classList.remove('hidden');
                    cart = [];
                    updateCartUI();
                    toggleCart();
                } catch(e) { alert('เกิดข้อผิดพลาดในการซื้อ'); }
            }
        }

        async function submitDeposit() {
            const amt = parseFloat(document.getElementById('dep-amt').value);
            const ref = document.getElementById('dep-ref').value;
            if(!amt || !ref) return alert('กรอกข้อมูลให้ครบ');
            await db.collection('shop').doc(VER).collection('deposits').add({
                uid: auth.currentUser.uid, username: userData.username, amount: amt, ref: ref, status: 'pending'
            });
            alert('แจ้งฝากเรียบร้อยแล้ว');
            document.getElementById('dep-amt').value = '';
            document.getElementById('dep-ref').value = '';
        }

        function loadAdminTasks() {
            db.collection('shop').doc(VER).collection('deposits').onSnapshot(snap => {
                const list = document.getElementById('admin-dep-list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    if(d.status === 'pending') {
                        list.innerHTML += `
                            <div class="glass-card p-4 rounded-2xl border-yellow-500/20">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <p class="text-xs font-bold text-white uppercase">${d.username}</p>
                                        <p class="text-[10px] text-yellow-500 font-black">แจ้งฝาก ฿ ${d.amount}</p>
                                    </div>
                                    <span class="text-[8px] text-gray-500 font-mono">${d.ref}</span>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="approveDep('${doc.id}', '${d.uid}', ${d.amount})" class="flex-1 bg-green-500 text-black py-2 rounded-lg text-[9px] font-black uppercase">Approve</button>
                                    <button onclick="db.collection('shop').doc('${VER}').collection('deposits').doc('${doc.id}').delete()" class="flex-1 bg-red-500/20 text-red-500 py-2 rounded-lg text-[9px] font-black uppercase">Delete</button>
                                </div>
                            </div>
                        `;
                    }
                });
            });
        }

        async function approveDep(did, uid, amt) {
            await db.collection('shop').doc(VER).collection('users').doc(uid).update({
                balance: firebase.firestore.FieldValue.increment(amt)
            });
            await db.collection('shop').doc(VER).collection('deposits').doc(did).update({ status: 'done' });
            alert('อนุมัติยอดเงินแล้ว');
        }

        async function adminAddProduct() {
            const cat = document.getElementById('p-cat').value;
            const name = document.getElementById('p-name').value;
            const price = parseFloat(document.getElementById('p-price').value);
            const stock = document.getElementById('p-stock').value.split('\n').filter(s => s.trim() !== '');
            if(!name || !price || stock.length === 0) return alert('ข้อมูลไม่ครบ');
            await db.collection('shop').doc(VER).collection('products').add({ category: cat, name, price, stock });
            alert('เพิ่มสินค้าสำเร็จ');
            document.getElementById('p-name').value = '';
            document.getElementById('p-stock').value = '';
        }
    </script>
</body>
</html>

