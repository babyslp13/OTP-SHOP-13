<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTPSHOP - Member System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap');
        body { font-family: 'Kanit', sans-serif; background-color: #060608; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .btn-gradient { background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%); }
        input { background: #111118 !important; border: 1px solid #333 !important; color: white !important; outline: none; }
        .hidden { display: none; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen relative pb-24">

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
    <div id="auth-layer" class="fixed inset-0 z-[1000] bg-[#060608] flex items-center justify-center p-6 overflow-y-auto">
        <div class="glass p-8 rounded-[2.5rem] w-full border border-purple-500/20 shadow-2xl my-auto">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center text-3xl shadow-lg">üîê</div>
                <h2 id="auth-title" class="text-2xl font-black italic uppercase">Login</h2>
                <p id="auth-subtitle" class="text-gray-500 text-[10px] mt-1 uppercase font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>
            </div>

            <div class="space-y-3">
                <!-- ‡∏ä‡πà‡∏≠‡∏á Username (‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á Login ‡πÅ‡∏•‡∏∞ Register) -->
                <div class="space-y-1">
                    <label class="text-[10px] text-gray-500 uppercase ml-4 font-bold">Username</label>
                    <input type="text" id="auth-username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full p-4 rounded-2xl text-sm">
                </div>

                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô -->
                <div id="register-only" class="hidden space-y-3">
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-500 uppercase ml-4 font-bold">Recovery Email</label>
                        <input type="email" id="auth-email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏π‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-4 rounded-2xl text-sm">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-500 uppercase ml-4 font-bold">Password</label>
                        <input type="password" id="auth-reg-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-4 rounded-2xl text-sm">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-500 uppercase ml-4 font-bold">Confirm Password</label>
                        <input type="password" id="auth-confirm-password" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" class="w-full p-4 rounded-2xl text-sm">
                    </div>
                </div>

                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô -->
                <div id="login-only" class="space-y-1">
                    <label class="text-[10px] text-gray-500 uppercase ml-4 font-bold">Password</label>
                    <input type="password" id="auth-login-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-4 rounded-2xl text-sm">
                </div>
                
                <button onclick="handleAuth()" class="w-full btn-gradient p-4 rounded-2xl font-black uppercase tracking-widest shadow-lg mt-4 active:scale-95 transition">
                    ‡∏ï‡∏Å‡∏•‡∏á
                </button>
                
                <p class="text-center text-xs text-gray-500 mt-4">
                    <span id="toggle-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?</span>
                    <button onclick="toggleMode()" class="text-purple-500 font-bold" id="toggle-btn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                </p>
            </div>
        </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß -->
    <div id="main-app" class="hidden">
        <header class="p-6 flex justify-between items-center border-b border-white/5 sticky top-0 bg-[#060608]/80 backdrop-blur-md">
            <span class="font-black text-xl italic uppercase">OTP<span class="text-purple-500">Shop</span></span>
            <div class="glass px-4 py-2 rounded-2xl">
                <p class="text-[9px] text-gray-500 font-bold uppercase">Credit</p>
                <p class="text-purple-400 font-black" id="balance-display">‡∏ø 0.00</p>
            </div>
        </header>
        
        <main class="p-6">
            <div class="glass p-6 rounded-[2rem] text-center mb-6">
                <p class="text-sm">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <span id="user-display" class="font-bold text-purple-500"></span></p>
            </div>
            
            <h3 class="font-bold mb-4">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
            <div class="grid grid-cols-2 gap-4">
                <div class="glass p-6 rounded-[2rem] text-center" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô')">
                    <p class="font-bold">Facebook</p>
                    <p class="text-purple-500">20 THB</p>
                </div>
                <div class="glass p-6 rounded-[2rem] text-center" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô')">
                    <p class="font-bold">Line</p>
                    <p class="text-purple-500">20 THB</p>
                </div>
            </div>

            <button onclick="firebase.auth().signOut()" class="w-full mt-12 bg-red-500/10 text-red-500 p-4 rounded-2xl font-bold uppercase text-xs border border-red-500/20">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </main>
    </div>

    <script>
        // *** 1. ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase Console ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ ***
        const myFirebaseConfig = {
            apiKey: "", 
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö config
        const config = (myFirebaseConfig.apiKey === "") ? JSON.parse(__firebase_config) : myFirebaseConfig;

        firebase.initializeApp(config);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'otp-shop-v2';

        let isLogin = true;

        function toggleMode() {
            isLogin = !isLogin;
            document.getElementById('auth-title').innerText = isLogin ? 'Login' : 'Register';
            document.getElementById('register-only').classList.toggle('hidden', isLogin);
            document.getElementById('login-only').classList.toggle('hidden', !isLogin);
            document.getElementById('toggle-btn').innerText = isLogin ? '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            document.getElementById('toggle-text').innerText = isLogin ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?' : '‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß?';
        }

        async function handleAuth() {
            const username = document.getElementById('auth-username').value.trim().toLowerCase();
            if(!username) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username');

            try {
                if(isLogin) {
                    const password = document.getElementById('auth-login-password').value;
                    // ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô Email ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å Username
                    await auth.signInWithEmailAndPassword(`${username}@internal.otp`, password);
                } else {
                    const email = document.getElementById('auth-email').value.trim();
                    const password = document.getElementById('auth-reg-password').value;
                    const confirm = document.getElementById('auth-confirm-password').value;

                    if(!email || !password) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
                    if(password !== confirm) return alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                    if(password.length < 6) return alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß');

                    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏î‡πâ‡∏ß‡∏¢ Email ‡∏à‡∏£‡∏¥‡∏á (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô)
                    const res = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Firestore
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').doc(res.user.uid).set({
                        username: username,
                        recoveryEmail: email,
                        balance: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á Email ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Username ‡πÑ‡∏î‡πâ
                    // ‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥ Firebase ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Username ‡∏ï‡∏£‡∏á‡πÜ ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ Email ‡∏à‡∏≥‡∏•‡∏≠‡∏á
                    // ‡∏´‡∏≤‡∏Å‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Firebase ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Email/Password ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                    alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                }
            } catch (err) {
                console.error(err);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
            }
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('auth-layer').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').doc(user.uid)
                .onSnapshot(doc => {
                    if(doc.exists) {
                        const data = doc.data();
                        document.getElementById('user-display').innerText = data.username;
                        document.getElementById('balance-display').innerText = `‡∏ø ${data.balance.toFixed(2)}`;
                    }
                });
            } else {
                document.getElementById('auth-layer').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });
    </script>
</body>
</html>

